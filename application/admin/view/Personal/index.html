{extend name="index" /} {block name="content"}
<div class="panel-body"></div>
<div class="row" ng-app="app">
    <div class="col-md-11" ng-controller="editController">
        <div class="panel panel-default" >
          <div class="panel-body">
              <div class="row">
                  <form class="form-horizontal" action="{:url('update')}" name="myForm" ng-submit="submit()">
                      <div class="form-group">
                          <label class="col-md-2 control-label">用户名</label>
                          <div class="col-md-3">
                              <input type="text" class="form-control" value="{$currentUserModel->getData('username')}" disabled="disabled">
                          </div>
                      </div>
                      <div class="form-group">
                          <label class="col-md-2 control-label">昵称</label>
                          <div class="col-md-3">
                              <input type="text" class="form-control" value="{$currentUserModel->getData('name')}" name="name">
                          </div>
                      </div>
                      <div class="form-group">
                          <label for="phonenumber" class="col-md-2 text-right">手机号</label>
                          <div class="col-md-3">
                              <input class="form-control" name="phonenumber" ng-model="phonenumber" ng-pattern="regex" required/>
                          </div>
                          <p class="text-danger" ng-show="myForm.phonenumber.$dirty && myForm.phonenumber.$invalid">
                              <span ng-show="myForm.phonenumber.$error.pattern">*请输入正确的11位手机号码</span>
                          </p>
                      </div>
                      <div class="form-group">
                          <label for="username" class="col-md-2 text-right">邮箱</label>
                          <div class="col-md-3">
                              <input class="form-control" type="email" name="email" ng-model="email" type="email" required/>
                          </div>
                          <p class="text-danger" ng-show="myForm.email.$dirty && myForm.email.$invalid"> <span ng-show="myForm.email.$error.required">邮箱不能为空</span></p>
                          <span class="text-danger" ng-show="myForm.email.$dirty && myForm.email.$invalid">
                              <span ng-show="myForm.email.$error.email">*邮箱格式错误</span>
                          </span>
                      </div>
                      <div class="form-group">
                          <label for="password" class="col-md-2 text-right">原密码</label>
                          <div class="col-md-3">
                              <input class="form-control" type="password" ng-model="password" id="password" name="password" required/>
                          </div>
                          <span class="text-danger" ng-show="myForm.password.$error.required && myForm.password.$error.$dirty" required>*请输入原密码</span>
                      </div>
                      <div class="form-group">
                          <label for="newpassword" class="col-md-2 text-right">新密码</label>
                          <div class="col-md-3">
                              <input class="form-control" type="password" ng-model="newpassword" ng-minlength="6" ng-maxlength="20" name="newpassword" required/>
                          </div>
                          <span class="text-danger" ng-show="myForm.newpassword.$invalid && myForm.newpassword.$dirty"><code>密码长度不小于6位，不大于20位</code></span>
                      </div>
                      <div class="form-group">
                          <label for="repassword" class="col-md-2 text-right">确认密码</label>
                          <div class="col-md-3">
                              <input class="form-control" type="password" ng-model="repassword" name="repassword" required/>
                          </div>
                          <span class="text-danger" ng-show="myForm.repassword.$dirty"></span>
                          <code>{{hasError}}</code>
                          <span class="text-danger" ng-show="different"> 再次输入新密码</span>
                      </div>
                      <div class="form-group">
                          <div class="col-md-offset-3 col-md-10">
                              <button type="submit" class="btn btn-md btn-success" ng-disabled="myForm.phonenumber.$invalid || myForm.email.$invalid"><i class="fa fa-check "></i>确认</button>
                          </div>
                      </div>
                  </form>
              </div>
          </div>
        </div>
    </div>
</div>
<script>
app.controller('editController', function ($scope){
   $scope.email = "{$currentUserModel.email}"; //邮箱的验证
   $scope.phonenumber = "{$currentUserModel.phonenumber}";
   $scope.regex = "^0?1[0-9]{10}$"; //手机号码的验证
   //确认密码验证
   $scope.hasError = "";
   $scope.newpassword = "";
   $scope.repassword = "";
   $scope.submitDisable = 0;

   $scope.submit = function() {};
   $scope.$watchGroup(["newpassword", "repassword"], function() {
       if ($scope.newpassword !== $scope.repassword) {
           $scope.hasError = "两次密码不一致";
           $scope.submitDisable = 1;
       } else {
           $scope.hasError = "";
           $scope.submitDisable = 0;
       }
   });
});
</script>


{/block}
